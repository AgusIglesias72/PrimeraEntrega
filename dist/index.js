(()=>{"use strict";var t={626:function(t,e,i){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(i(514));o(i(142)).default.config();const n=(0,r.default)({client:"pg",connection:{host:process.env.DB_HOST,port:5432,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE,ssl:!0}});e.default=n},607:function(t,e,i){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(i(860)),n=o(i(731)),s=o(i(315)),d=o(i(318)),a=o(i(958)),u=o(i(17));o(i(142)).default.config();const c=(0,r.default)();c.use(r.default.json());const l=process.env.PORT||3e3;c.use(r.default.static(u.default.join(__dirname,"/build"))),c.get("/",((t,e)=>{e.sendFile(u.default.join(__dirname,"/build","index.html"))})),c.use("/api/products/",n.default),c.use("/api/shipcart/",s.default),c.use("/api/addtocart/",a.default),c.use("/api/store/",d.default),c.listen(l,(()=>{console.log(`Server running port ${l}`),console.log(u.default.join(__dirname,"../build"))}))},731:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function s(t){try{a(o.next(t))}catch(t){n(t)}}function d(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(i(860)),s=i(620),d=i(108),a=n.default.Router(),u=new d.ContenedorSQL("products");a.get("/",((t,e)=>o(void 0,void 0,void 0,(function*(){try{const t=yield u.getAll();e.status(200).json(t)}catch(t){e.status(404).json({error:t.message})}})))),a.post("/",((t,e)=>o(void 0,void 0,void 0,(function*(){try{const i=(0,s.toNewProductEntry)(t.body),o=yield u.postData(i);e.status(201).json(o)}catch(t){e.status(400).json({error:t.message})}})))),a.get("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id);try{const t=yield u.getById(i);e.status(200).json(t)}catch(t){e.status(404).json({error:t.message})}})))),a.put("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id);try{const o=(0,s.updateProductEntry)(t.body),r=yield u.updateById(i,o);e.status(200).json(r)}catch(t){e.status(400).json({error:t.message})}})))),a.delete("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id);try{const t=yield u.deleteById(i);e.status(204).json(t)}catch(t){e.status(404).json({error:t.message})}})))),e.default=a},315:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function s(t){try{a(o.next(t))}catch(t){n(t)}}function d(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(i(860)),s=i(108),d=n.default.Router(),a=new s.ContenedorSQL("ship_cart");d.get("/",((t,e)=>o(void 0,void 0,void 0,(function*(){try{const t=yield a.playground();e.status(200).json(t)}catch(t){e.status(500).json({error:"No se pudo procesar la solicitud"})}})))),d.post("/",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=t.body.store_id;try{const t=yield a.postData({store_id:i});e.status(201).json(t)}catch(t){e.status(400).json({error:"No se pudo procesar la solicitud"})}})))),d.get("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id);try{const t=yield a.getById(i);e.status(200).json(t)}catch(t){e.status(404).json({error:"No se pudo procesar la solicitud"})}})))),d.put("/:id",((t,e)=>{})),d.delete("/:id",((t,e)=>{})),e.default=d},958:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function s(t){try{a(o.next(t))}catch(t){n(t)}}function d(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(i(860)),s=i(108),d=n.default.Router(),a=new s.ProductsOperations("ship_cart_items");d.post("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id),o=t.body.product_id,r=t.body.operation;try{const t=yield a.UpdateOrCreate(i,o,r);e.status(201).json(t)}catch(t){e.status(400).json({error:t.message})}})))),d.get("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id);try{const t=yield a.getById(i);e.status(200).json(t)}catch(t){e.status(404).json({error:t.message})}})))),d.delete("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){const i=Number(t.params.id);try{const t=yield a.deleteAllProducts(i);e.status(200).json(t)}catch(t){e.status(404).json({error:t.message})}})))),d.put("/:id",((t,e)=>{})),e.default=d},318:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function s(t){try{a(o.next(t))}catch(t){n(t)}}function d(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(i(860)),s=i(108),d=n.default.Router(),a=new s.ContenedorSQL("stores");d.get("/",((t,e)=>o(void 0,void 0,void 0,(function*(){try{const t=yield a.getAll();e.status(200).json(t)}catch(t){e.status(404).json({error:t.message})}})))),d.post("/",((t,e)=>o(void 0,void 0,void 0,(function*(){})))),d.get("/:id",((t,e)=>o(void 0,void 0,void 0,(function*(){})))),d.put("/:id",((t,e)=>{})),d.delete("/:id",((t,e)=>{})),e.default=d},620:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.updateProductEntry=e.toNewProductEntry=e.isNumber=e.isString=void 0;const i=t=>{if(!(0,e.isString)(t))throw new Error("Título no válido");if(t.length>50||t.length<5)throw new Error("El título debe tener entre 5 y 50 caracteres");return t},o=t=>{if(!(0,e.isString)(t))throw new Error("Título no válido");if(t.length>350)throw new Error("La descripción debe tener menos de 350 caracteres");return t},r=t=>{if(!(0,e.isNumber)(t))throw new Error("Precio no válido");if(t<0)throw new Error("El precio debe ser mayor a 0");return t},n=t=>{if(!(0,e.isNumber)(t))throw new Error("Id de tienda no válido");return t};e.isString=t=>"string"==typeof t||t instanceof String,e.isNumber=t=>"number"==typeof t&&isFinite(t),e.toNewProductEntry=t=>({title:i(t.title),description:o(t.description),store_id:n(t.store_id),price:r(t.price)}),e.updateProductEntry=t=>(Object.keys(t).map((e=>("title"===e&&(t[e]=i(t[e])),"description"===e&&(t[e]=o(t[e])),"price"===e&&(t[e]=r(t[e])),"store_id"===e&&(t[e]=n(t[e])),t))),t)},108:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function s(t){try{a(o.next(t))}catch(t){n(t)}}function d(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,d)}a((o=o.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ProductsOperations=e.ContenedorSQL=void 0;const n=r(i(626));e.ContenedorSQL=class{constructor(t){this.knexCli=n.default,this.tableName=t}getAll(){return o(this,void 0,void 0,(function*(){return this.knexCli.from(this.tableName).select("*")}))}getById(t){return o(this,void 0,void 0,(function*(){const e=yield this.knexCli.from(this.tableName).where({id:t}).select("*");if(0===e.length)throw new Error("No se encontró el elemento");return e}))}updateById(t,e){return o(this,void 0,void 0,(function*(){return this.knexCli.from(this.tableName).where({id:t}).update(e).returning("*")}))}postData(t){return o(this,void 0,void 0,(function*(){return this.knexCli.from(this.tableName).insert(t).returning("*")}))}deleteById(t){return o(this,void 0,void 0,(function*(){const e=yield this.knexCli.from(this.tableName).where({id:t}).del();if(0===e)throw new Error("No se encontró el elemento");return e}))}playground(){return o(this,void 0,void 0,(function*(){const t=this.knexCli.select("sc.id as id_carrito","sc.date_created as date_created","p.id as id_prod",{precio:this.knexCli.max("p.price")},{precio_total:this.knexCli.sum("p.price")},{cantidad:this.knexCli.sum("p.quantity")}).from("ship_cart as sc").join((function(){this.select("sci.ship_cart_id","pr.id","pr.price","sci.quantity").from("ship_cart_items as sci").join("products as pr","sci.product_id","=","pr.id").as("p")}),"sc.id","=","p.ship_cart_id").groupBy("id_prod","id_carrito").as("main");return this.knexCli.select("main.id_carrito","main.date_created",this.knexCli.raw("JSON_AGG(JSON_BUILD_OBJECT('id', main.id_prod, 'precio', main.precio, 'precio_total', main.precio_total, 'cantidad', main.cantidad)) as productos")).from(t).groupBy("main.id_carrito","main.date_created")}))}},e.ProductsOperations=class{constructor(t){this.knexCli=n.default,this.tableName=t}getById(t){return o(this,void 0,void 0,(function*(){return this.knexCli.from(this.tableName).where({ship_cart_id:t}).select("*")}))}UpdateOrCreate(t,e,i){return o(this,void 0,void 0,(function*(){const o=yield this.knexCli.update("quantity",this.knexCli.raw(`quantity + ${i}`)).from(this.tableName).where({ship_cart_id:t,product_id:e}).returning("*");return 0===o.length?yield this.knexCli.from(this.tableName).insert({ship_cart_id:t,product_id:e}).returning("*"):o[0].quantity<=0?(yield this.knexCli.from(this.tableName).where("quantity","<=",0).delete(),{message:"Producto eliminado"}):o}))}deleteAllProducts(t){return o(this,void 0,void 0,(function*(){return yield this.knexCli.from(this.tableName).where({ship_cart_id:t}).delete()}))}}},142:t=>{t.exports=require("dotenv")},860:t=>{t.exports=require("express")},514:t=>{t.exports=require("knex")},17:t=>{t.exports=require("path")}},e={};!function i(o){var r=e[o];if(void 0!==r)return r.exports;var n=e[o]={exports:{}};return t[o].call(n.exports,n,n.exports,i),n.exports}(607)})();